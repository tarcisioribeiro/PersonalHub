# Kind cluster configuration for MindLedger
# This file configures the kind cluster with:
# - Container registry connectivity
# - Port mappings for external access
# - Extra mounts for local development (optional)
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
name: mindledger
containerdConfigPatches:
  # Configure containerd to use local registry
  - |-
    [plugins."io.containerd.grpc.v1.cri".registry.mirrors."localhost:5000"]
      endpoint = ["http://kind-registry:5000"]
nodes:
  - role: control-plane
    # Use stable Kubernetes version (1.31.0) for reliability
    image: kindest/node:v1.31.0@sha256:53df588e04085fd41ae12de0c3fe4c72f7013bba32a20e7325357a1ac94ba865
    kubeadmConfigPatches:
      - |
        kind: InitConfiguration
        nodeRegistration:
          kubeletExtraArgs:
            node-labels: "ingress-ready=true"
    extraPortMappings:
      # API access via localhost:39100
      - containerPort: 30100
        hostPort: 39100
        protocol: TCP
      # Frontend access via localhost:39101
      - containerPort: 30101
        hostPort: 39101
        protocol: TCP
      # PostgreSQL access via localhost:39102 (for external tools like DBeaver)
      - containerPort: 30102
        hostPort: 39102
        protocol: TCP
